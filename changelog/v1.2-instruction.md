
## Instruction for mainnet v1.2.0 upgrade
First, go to the `iotex-var` folder on your node (where it has 3 sub-folders
`etc`, `data`, `log`)
```
export IOTEX_HOME=$PWD
```

#### Step 1:
If your node is **not** running as gateway, that is, the docker command used to
start the node does **not** have `-plugin=gateway` at the end:
> simply stop the node, then restart the node using image v1.2.0.
> Stop here, you are done

You can also check files under `$IOTEX_HOME/data`, if you don't see a file named
`index.db`, then your node is **not** running as gateway.

#### Step 2:
Otherwise, the node is running as a gateway. In this case, you'll need to wipe
out the data and start from latest snapshot, due to some index file in v1.2 is
not backward-compatible.
```
rm -rf $IOTEX_HOME/data
curl -L https://t.iotex.me/mainnet-data-with-idx-latest > $IOTEX_HOME/data.tar.gz
tar -xzf data.tar.gz
```
then restart the node using image v1.2.0

Since downloading and extracting data may take quite some time, we **strongly**
recommend you do the upgrade in an epoch when the node is not chosen as active
delegate. This would prevent your node from being possibly probated and lose
productivity.

## Instruction for testnet v1.2.0 upgrade
To upgrade to testnet v1.2.0, the procedure is same as that of mainnet, except
these 2:

1. In step 2, download the snapshot from `https://t.iotex.me/testnet-data-with-idx-latest`
2. Run Step 0 below, before starting Step 1

#### Step 0:
1. Save the private key and external IP address, i.e., the `producerPrivKey:`
and `externalHost` line in file `$IOTEX_HOME/etc/config.yaml`
2. Upgrade the config and genesis yaml
```
curl https://raw.githubusercontent.com/iotexproject/iotex-bootstrap/v1.2.0/config_testnet.yaml > $IOTEX_HOME/etc/config.yaml
curl https://raw.githubusercontent.com/iotexproject/iotex-bootstrap/v1.2.0/genesis_testnet.yaml > $IOTEX_HOME/etc/genesis.yaml

```
set the private key and external IP back into `$IOTEX_HOME/etc/config.yaml`

then continue onto Step 1 and 2.
